<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Meme Generator</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

	<div id="wrapper">
		<form id="meme-form">
			<label for="url">URL</label><br>
			<input id="url" type="url"><br><br>
			<label for="name">Name</label><br>
			<input id="name" type="text"><br><br>
			<label for="top">Top Text</label><br>
			<input id="top" type="text"><br><br>
			<label for="bottom">Bottom Text</label><br>
			<input id="bottom" type="text"><br><br>
			<input type="button" value="submit" onclick="send_request()">
		</form>

		<img id="meme" src="">
	</div>

	<script>
		let apiURL = 'http://localhost:4568/'
		function send_request() {
			let url = document.getElementById('url').value;
			let name = document.getElementById('name').value;
			let top = document.getElementById('top').value;
			let bottom = document.getElementById('bottom').value;
			api_call('generate_image', { 'url': url, 'name': name, 'top': top, 'bottom': bottom }, function () {
				console.log(data);
				document.getElementById('meme').src = data.url;
				document.getElementById('meme-form').style.display = 'none';
			});
		}

		function api_call(endpoint, options, func) {
			var xhr = new XMLHttpRequest();
			xhr.open('POST', apiURL + endpoint + '?' + encode_params(options));
			xhr.onload = function () {
				if (xhr.status === 200) {
					data = JSON.parse(xhr.responseText);
					func(data);
				} else {
					alert('Request failed.  Returned status of ' + xhr.status);
				}
			};
			xhr.send(encodeURI());
		}

		function encode_params(object) {
			var encodedString = '';
			for (var prop in object) {
				if (object.hasOwnProperty(prop)) {
					if (encodedString.length > 0) {
						encodedString += '&';
					}
					encodedString += encodeURI(prop + '=' + object[prop]);
				}
			}
			return encodedString;
		}
	</script>
</body>

</html>